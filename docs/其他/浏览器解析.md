## 浏览器解析

* `URL`到界面显示发生了什么
  * `DNS`解析
    * 浏览器根据 DNS 服务器得到域名的 `IP`地址
  * `TCP`连接, 三次握手，只要没收到确认消息就要重新发
    * 主机向服务器发送一个建立连接的请求（您好，我想认识您）；
    * 服务器接到请求后发送同意连接的信号（好的，很高兴认识您）；
    * 主机接到同意连接的信号后，再次向服务器发送了确认信号（我也很高兴认识您），自此，主机与服务器两者建立了连接。
  * 发送`HTTP`请求
    * 浏览器会分析这个`url`，并设置好请求报文发出。
    * 请求报文中包括请求行、请求头、空行、请求主体。
    * `https`默认请求端口`443`， `http`默认端口`80`。
  * 浏览器解析渲染页面
    * 通过`HTML`解析器解析`HTML`文档，构建一个`DOM Tree`
    * 同时通过`CSS`解析器解析`HTML`中存在的`CSS`，构建`Style Rules`，两者结合形成一个`Attachment`。
    * 通过`Attachment`构造出一个呈现树（`Render Tree`）
    * `Render Tree`构建完毕，进入到布局阶段（`layout/reflow`），将会为每个阶段分配一个应出现在屏幕上的确切坐标。
    * 最后将全部的节点遍历绘制出来后，一个页面就展现出来了。遇到`script`会停下来执行，所以通常把`script`放在底部
  * 连接结束
  * ** 浏览器工作流程：构建`DOM` -> 构建`CSSOM` -> 构建渲染树 -> 布局（回流、重绘） -> 绘制。 **


* 重绘与回流
  * 重绘：当我们对 `DOM` 的修改导致了样式的变化、却并未影响其几何属性（比如修改了颜色或背景色）时，
    浏览器不需重新计算元素的几何属性、直接为该元素绘制新的样式（跳过了上图所示的回流环节）。
  * 回流：当我们对 `DOM` 的修改引发了 `DOM` 几何尺寸的变化（比如修改元素的宽、高或隐藏元素等）时，
    浏览器需要重新计算元素的几何属性（其他元素的几何属性和位置也会因此受到影响），
    然后再将计算的结果绘制出来。这个过程就是回流（也叫重排）
  * ** 回流必定会发生重绘，重绘不一定会引发回流 **
* 常见引起回流属性和方法（改变几何尺寸）
  * 添加或者删除可见的DOM元素；
  * 元素尺寸改变——边距、填充、边框、宽度和高度
  * 内容变化，比如用户在`input`框中输入文字
  * 浏览器窗口尺寸改变——`resize`事件发生时
  * 计算 `offsetWidth` 和 `offsetHeight` 属性
  * 设置 `style` 属性的值
* 常见引起重绘属性和方法
  * `color`、`border`、`visibility`、`background`、`border-radius`等
* 如何减少回流、重绘
  * 使用 `transform` 替代 `top`
  * 使用 `visibility` 替换 `display: none` ，因为前者只会引起重绘，后者会引发回流（改变了布局）
  * 不要把节点的属性值放在一个循环里当成循环里的变量。
  * 不要使用 `table` 布局，可能很小的一个小改动会造成整个 `table` 的重新布局
  * 动画实现的速度的选择，动画速度越快，回流次数越多，也可以选择使用 `requestAnimationFrame`
  * `CSS` 选择符从右往左匹配查找，避免节点层级过多
  * 将频繁重绘或者回流的节点设置为图层，图层能够阻止该节点的渲染行为影响别的节点
    比如对于 `video` 标签来说，浏览器会自动将该节点变为图层
